// require packages
var mysql = require("mysql");
var inquirer = require("inquirer");

// create connection information for sql database
var connection = mysql.createConnection({
    host: "localhost",
    port: 3306,
    // Your username
    user: "root",
    // Your password
    password: "password123",
    database: "bamazon"
});

// connect to the mysql server and sql database
connection.connect(function (err) {
    if (err) throw err;
    // display message once connection is made
    console.log(">>> Connection to bamazon successful! <<<");
    // run the displayItems after the connection is made
    displayItems();
});

// displays items in bamazon database
function displayItems() {
    connection.query("SELECT * FROM products", function (err, res) {
        if (err) throw err;
        console.log(res);
        // run itemCheck function after displayItems runs
        itemCheck();        
        //get a single record after getting all records from the db
    });
}

// ask user what item they want from the list
function itemCheck() {
    // 1) the ID of product they want to buy
    // 2) how many units they want to buy
    inquirer.prompt([
            {
                name: "productID",
                type: "input",
                message: "\n========================================\n\nFrom the list above, what is the ID of the product you want to buy?",
                validate: function (value) {
                    if (isNaN(value) === false) {
                        return true;
                    }
                    return false;
                }
            },
            {
                name: "quantity",
                type: "input",
                message: "\n========================================\n\nHow many of this product do you want to buy?",
                validate: function (value) {
                    if (isNaN(value) === false) {
                        return true;
                    }
                    return false;
                }
            }
        ]);
        // ]).then(function(answer){
        //     var chosenItem;
        //     for (var i =0; i < )
        // });
        // then take 
    }

  

// once user places order then
    // check if product has stock
    // if in stock then fulfill order
        // subtract respectively from database
        // and show customer cost of purchase
    // if not in stock then 
        // tell customer "insufficient quantity" end order



        =====

        function itemReq() {
    // 1) the ID of product they want to buy
    // 2) how many units they want to buy
    inquirer.prompt([
        {
            name: "productNumber",
            type: "input",
            message: "\n========================================\n\nFrom the list above, what is the ID of the product you want to buy?",
            validate: function (value) {
                if (isNaN(value) === false) {
                    return true;
                }
                console.log("That is an invalid input. Please input an ID number.");                
                return false;
            }
        }
    ])
        .then(function (answer) {
         
            var chosenItem;
            for (var i = 0; i < results.length; i++) {
              if (results[i].product_name === answer.productNumber) {
                chosenItem = results[i];
              }
            }
            // determine if bid was high enough
            if (chosenItem.highest_bid < parseInt(answer.bid)) {
              // bid was high enough, so update db, let the user know, and start over
              connection.query(
                "UPDATE auctions SET ? WHERE ?",
                [
                  {
                    highest_bid: answer.bid
                  },
                  {
                    id: chosenItem.id
                  }
                ],
                function(error) {
                  if (error) throw err;
                  console.log("Bid placed successfully!");
                  start();
                }
              );
            }
            else {
              // bid wasn't high enough, so apologize and start over
              console.log("Your bid was too low. Try again...");
              start();
            }
          });
      }